# $Id: a63eb5e999433ab567e0fe702b9925632becbae8 $

#set -x
zmodload zsh/mathfunc
#zmodload zsh/zftp
autoload -U zkbd colors #zfinit
colors
#zfinit

# No One Does This Anymore
#if [ -n "$(which mesg)" ]; then
#	mesg y
#fi

# PATH is modified to have unique entries, include custom directories and local directories (like /usr/local/bin/)
# removing repetitive occurrences of local directories is left as it is unneeded
#local_dirs=`echo $PATH|sed -e 's/:/\n/g'|grep local|xargs|sed -e 's/ /:/g'`
#PATH=/tmp/dont.delete/fakeroot/bin:/usr/stud/srivasta/bin:$local_dirs:`echo $PATH|sed \
#	-e 's/:/\n/g' \
#	-e 's/\.\n//g' \
#	-e 's/\.$//g' \
#	-e 's,/tmp/dont.delete/fakeroot/bin,,g' \
#	-e "s,$HOME,,g"|sort|uniq|xargs|sed -e 's/ /:/g'`

# First thing first: we don't want .xsession-errors file to be created!
# (If we want, then we disable this line)
unfunction startx

typeset -U path
path=( $^path(N) )
export PATH=`echo /tmp/dont.delete/fakeroot/opt/openoffice.org/program:/tmp/dont.delete/fakeroot/bin:$HOME/bin:/usr/lib/ICAClient:/opt/pgi/linux86/7.0/bin:$PATH|sed -e 's/:\.:/:/g'`
# Synopsis:
# 1) Remove non-existant or repetitive entries, and sort them - this ensures that current directory is first entry (".:")
# 2) Added custom directories in the order you like. Current directory should have become ":.:" now, so remove it.

export MANPATH="/tmp/dont.delete/fakeroot/man:/tmp/dont.delete/fakeroot/share/man:$HOME/man:$HOME/share/man:$MANPATH"
export G_FILENAME_ENCODING=UTF-8
# Taken and modified from "atom's .zshrc" public release v0.109 - http://smasher.org/zsh/
precmd () {
  local exitstatus="${?}"
  if [[ ${exitstatus} -ge 128 && $exitstatus -le (127+${#signals}) ]]; then
	  # Last process was killed by a signal.  Find out what it was from
	  # the $signals environment variable.
	  exitstuff="${signals[${exitstatus}-127]}"
  else
	  unset exitstuff
  fi
}

# Replaced precmd With chpwd, Format Taken From Official Zsh Site
# http://zsh.dotsrc.org/FAQ/zshfaq03.html
chpwd () {
	[[ -t 1 ]] || return
	case $TERM in
		sun-cmd) print -Pn "\e]l%~\e\\"
		;;
		*xterm*|rxvt*|(dt|k|E)term|screen) print -Pn "\033]0;%n@%m:%~\007"
		;;
	esac
}
chpwd

source ~/.zkbd/$TERM-$VENDOR-$OSTYPE
[[ -n ${key[Backspace]} ]] && bindkey "${key[Backspace]}" backward-delete-char
[[ -n ${key[Insert]} ]] && bindkey "${key[Insert]}" yank
[[ -n ${key[Home]} ]] && bindkey "${key[Home]}" beginning-of-line
[[ -n ${key[Delete]} ]] && bindkey "${key[Delete]}" delete-char
[[ -n ${key[End]} ]] && bindkey "${key[End]}" end-of-line
[[ -n ${key[Left]} ]] && bindkey "${key[Left]}" backward-char
[[ -n ${key[Right]} ]] && bindkey "${key[Right]}" forward-char
[[ -n ${key[PageUp]} ]] && bindkey "${key[PageUp]}" history-beginning-search-backward
[[ -n ${key[PageDown]} ]] && bindkey "${key[PageDown]}" history-beginning-search-forward

# remove nonstandard aliases
#unalias + - .. ... dir l la ll ls ls-l md o rd rehash unmount you which-command cd.. 2>/dev/null
unalias -m \*

unset LS LS_OPTIONS
# no spelling corrections:
#alias mv='nocorrect mv'
#alias cp='nocorrect cp'
#alias mr='nocorrect rm'
#alias yx='nocorrect echo lyx avoided'
#alias xy='nocorrect echo lyx avoided'
#alias ly='nocorrect echo lyx avoided'
# spelling mistakes are O.K.: (these should also be 'nocorrect..' for
# the reason above, but I am generally working when I need this, so...)
alias ivm='vim'
alias tial='tail'
# shortcuts:
alias y='exit'
alias ls='ls --color=auto' # Yeah, we don't want -F
alias ll='ls -l'
alias xpdf='acroread' # xpdf sucks!
win () {
	echo 'use "winwin" for intermediate window.'
	echo 'Starting Windows NT'
	wfcmgr -desc WindowsNT
}
ddb () {
	echo 'use "winwin" for intermediate window.'
	echo 'Starting DDB'
	wfcmgr -desc DDB
}
alias winwin='wfcmgr'
# Who Cares?
# alias ssh='ssh -c blowfish'
alias quit='echo "Type exit!!!"'
alias vi='vim' # We NEVER Want To Use Old Vi, Even By Mistake
# (Now) Useless Shortcuts
#alias qua='ssh schnabtn@ipvslogin.informatik.uni-stuttgart.de -X'
#alias xc1='ssh wess02@hwwxc1.hww.de -X'
alias sx8='ssh itthuang@a1.hww.de -X'
alias cacau='ssh ittms@cacau.hww.de -X'
#alias w1='ssh erato "xterm -e ssh wets01@hwwxc2.hww.de"'
#alias w2='ssh erato "xterm -e ssh wets02@hwwxc2.hww.de"'

# Checking if programs are installed or not
#quota 1>/dev/null 2> /dev/null
#if [ $? -gt 0 ]; then
#	alias quota='echo "quota is not installed on this computer!" >&2; ssh erato quota 2> /dev/null' >&2
#else
#	alias quota='quota 2> /dev/null'
#fi
# quota has now been copied to ~/bin directory
alias quota='quota 2> /dev/null'

# Only first opening may take time
vim () {
	~/bin/vim $@ || {
		alias vim=`whereis vim | cut -d' ' -f2`" --noplugin"
		eval vim $@
	}
}

vimdiff () {
	~/bin/vimdiff $@ || {
		alias vimdiff=`whereis vimdiff | cut -d' ' -f2`" --noplugin"
		eval vimdiff $@
	}
}

view () {
	~/bin/view $@ || {
		alias view=`whereis view | cut -d' ' -f2`" --noplugin"
		eval view $@
	}
}

# History Settings
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000

# Other Misc Settings
LISTMAX=0

eval `dircolors -b ~/.dir_colors`
export ZLS_COLORS=$LS_COLORS
export KDEDIRS=/tmp/dont.delete/fakeroot:$HOME:$HOME/.kde:/opt/kde3
#export QTDIR=/tmp/dont.delete/fakeroot
#export CVSROOT=/usr/stud/srivasta/src/Repository
# This is to enable Unicode layout, so that Hindi can be viewed correctly
export MOZ_ENABLE_PANGO=1

# Moved To .xinitrc
# this sets off the annoying beeps
#which xset 1>/dev/null 2>/dev/null
#if [ $? -lt 1 ]; then
#	xset b off
#fi

unset LESSOPEN

# NOT NEEDED
# try to set DISPLAY smart (from Hans) :)
#
#local WHOAMI _DISPLAY
#if test -z "$DISPLAY" -a -x /usr/local/bin/who ; then
#    WHOAMI="`who am i`"
#            _DISPLAY="`expr "$WHOAMI" : '.*(\([^\.][^\.]*\).*)'`:0.0"
#    if [ "${_DISPLAY}" != ":0:0.0" -a "${_DISPLAY}" != " :0.0" \
#         -a "${_DISPLAY}" != ":0.0" ]; then
#        export DISPLAY="${_DISPLAY}";
#    fi
#fi

umask 077

# To compile things
export F77=gfortran
export LDFLAGS="-L/tmp/dont.delete/fakeroot/lib -L$HOME/lib"
export CFLAGS="-O2 -pipe -I/tmp/dont.delete/fakeroot/include -I$HOME/include"
#export CXXFLAGS="$CFLAGS"
#export CPPFLAGS="$CFLAGS"
export LD_RUN_PATH="/tmp/dont.delete/fakeroot/lib:$HOME/lib:$LD_RUN_PATH"
export LD_LIBRARY_PATH="/tmp/dont.delete/fakeroot/lib:$HOME/lib:$LD_LIBRARY_PATH"
export PKG_CONFIG_PATH="/tmp/dont.delete/fakeroot/lib/pkgconfig:$PKG_CONFIG_PATH"
export ACLOCAL_FLAGS="-I /usr/share/aclocal -I /tmp/dont.delete/fakeroot/share/aclocal $ACLOCAL_FLAGS"

# Never "export" PROMPT and RPROMPT
PROMPT=$'%(?..%{\e[41;38m%}%B-%?-%b%{\e[0m%} )%(1j.%{\e[01;33m%}[%j] .)%{\e[01;32m%}%m%{\e[0m%} %{\e[01;36m%}%2~%{\e[0m%} %B%#%b '
RPROMPT=$'%{\e[00;07m%}%(?..$exitstuff)% %{\e[0m%} %T'

clear-screen () {
	zle -I;repeat $((LINES-2)) echo;clear
}
zle -N clear-screen

# Change the Language To US English (Unicode)
export LANG='en_US.UTF8'
export LC_ALL='en_US.UTF8'

# For occasional use of lynx
export LYNX_CFG=~/.lynx.cfg

# For colourful grep :)
export GREP_OPTIONS='--color=auto '"$GREP_OPTIONS"

# Adding functions for using Vim as man, info and perldoc
# But Only If Vim 7 Exists

# Completions system
# The following lines were added by compinstall
zstyle ':completion:*' completer _expand _complete _ignored
zstyle ':completion:*' expand prefix suffix
zstyle ':completion:*' file-sort name
zstyle ':completion:*' ignore-parents parent pwd ..
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' list-prompt %SAt %p: Hit TAB for more, or the character to insert%s
zstyle ':completion:*' list-suffixes true
zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}' 'l:|=* r:|=*' 'r:|[._-]=** r:|=**'
zstyle ':completion:*' menu select=long-list select=0
zstyle ':completion:*' preserve-prefix '//[^/]##/'
zstyle ':completion:*' select-prompt %SScrolling active: current selection at %p%s
zstyle ':completion:*' squeeze-slashes true
zstyle ':completion:*' verbose false
zstyle :compinstall filename "$HOME/.zshrc"

autoload -Uz compinit
compinit
# End of lines added by compinstall

# Added by me
zstyle ':completion::complete:*' use-cache 1
zstyle ':zftp:*' progress 'percent'

# Taken from _pdf
_fortran () {
	local expl
	_description files expl 'FORTRAN file'
	_files "$@" "$expl[@]" -g "*\.f*"
}

compdef '_files -g "*.mol2"'	molcloud
compdef '_files -g "*.vi*"'		lmolecules lmolecules.64 lmolecules.32 latoms
compdef '_fortran'	f90.sh f90debug.sh g95 pgf90 pgf77 gfortran
compdef '_tex'		kile
compdef '_dvi'		kdvi dvipdf
compdef '_make'		hmake
compdef '_files -g "*.par"'		createvap.sh
compdef '_files -g "*.(par|rst)"'	run2.sh ms2.linux

# Modified From www.sakana.fr/blog/2007/08/14/zsh-is-cool-stream-redirections/
# Another way to remove newlines
# sed -n '1h;2,$H;${g;s/\n/,/g;p}'
usrld () {
	echo "current user: "`who|cut -d' ' -f1|sort -u|sed ':a;N;$!ba;s/\n/, /g'`
	echo `uptime|cut -d, -f3`
}

# See http://www.cs.elte.hu/zsh-manual/zsh_16.html for reference
setopt                       \
     NO_all_export           \
        always_last_prompt   \
     NO_always_to_end        \
        append_history       \
     NO_auto_cd              \
        auto_list            \
        auto_menu            \
     NO_auto_name_dirs       \
        auto_param_keys      \
        auto_param_slash     \
        auto_pushd           \
        auto_remove_slash    \
     NO_auto_resume          \
        bad_pattern          \
        bang_hist            \
     NO_beep                 \
     NO_bg_nice              \
        brace_ccl            \
        bsd_echo             \
     NO_cdable_vars          \
     NO_chase_links          \
     NO_clobber              \
     NO_complete_aliases     \
        complete_in_word     \
     NO_correct              \
     NO_correct_all          \
     NO_csh_junkie_history   \
     NO_csh_junkie_loops     \
     NO_csh_junkie_quotes    \
     NO_csh_null_glob        \
        equals               \
     NO_err_exit             \
        exec                 \
        extended_glob        \
     NO_extended_history     \
        flow_control         \
        function_argzero     \
        glob                 \
     NO_glob_assign          \
        glob_complete        \
     NO_glob_dots            \
        glob_subst           \
        hash_cmds            \
        hash_dirs            \
        hash_list_all        \
        hist_allow_clobber   \
     NO_hist_beep            \
        hist_ignore_dups     \
        hist_ignore_space    \
        hist_ignore_all_dups \
     NO_hist_no_store        \
        hist_verify          \
     NO_hup                  \
     NO_ignore_braces        \
     NO_ignore_eof           \
        interactive_comments \
        inc_append_history   \
     NO_list_ambiguous       \
     NO_list_beep            \
        list_types           \
        long_list_jobs       \
        magic_equal_subst    \
        mail_warning         \
     NO_mark_dirs            \
        menu_complete        \
        multios              \
        nomatch              \
        notify               \
     NO_null_glob            \
        numeric_glob_sort    \
     NO_overstrike           \
        path_dirs            \
        posix_builtins       \
     NO_print_exit_value     \
     NO_prompt_cr            \
        prompt_subst         \
        pushd_ignore_dups    \
     NO_pushd_minus          \
        pushd_silent         \
        pushd_to_home        \
        rc_expand_param      \
     NO_rc_quotes            \
     NO_rm_star_silent       \
     NO_sh_file_expansion    \
        sh_option_letters    \
        short_loops          \
        share_history        \
     NO_sh_word_split        \
     NO_single_line_zle      \
     NO_sun_keyboard_hack    \
        unset                \
		zle
#     NO_verbose              \

